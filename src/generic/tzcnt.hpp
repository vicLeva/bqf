#ifndef __tzcnt__
#define __tzcnt__
#include <bit>
#include <bitset>
#include <cstdint>
#include <iostream>
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
#if defined(__aarch64__) || defined(_M_ARM64)
    #include <arm_neon.h>
#else
    #include <immintrin.h>
#endif
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int tzcnt_u32_c(uint32_t x)
{
    if (x == 0) {
        return sizeof(x) * 4; // Si x est zéro, tous les bits sont à zéro
    }

    int count = 0;
    while ((x & 1) == 0)
    {
        count++;
        x >>= 1;
    }

    return count;
}
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
int tzcnt_u64_c(uint64_t x) {
    if (x == 0) {
        return sizeof(x) * 8; // Si x est zéro, tous les bits sont à zéro
    }

    int count = 0;
    while ((x & 1) == 0)
    {
        count++;
        x >>= 1;
    }

    return count;
}
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
#if defined(__SSE4_2__)
int tzcnt_u32_builtin(uint32_t x)
{
    return __builtin_ctz(x);
}
#endif
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
#if defined(__SSE4_2__)
int tzcnt_u64_builtin(uint64_t x)
{
    return __builtin_ctzll(x);
}
#endif
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
#if defined(__SSE4_2__)
inline uint32_t tzcnt_u32_x86(uint32_t x) {
    uint64_t r;
    asm("tzcntq %1, %0" : "=r"(r) : "r"((uint64_t)x));
    return r;
}
#endif
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
#if defined(__SSE4_2__)
inline int tzcnt_u64_x86(uint64_t x) {
    uint64_t r;
    asm("tzcntq %1, %0" : "=r"(r) : "r"(x));
    return r;
}
#endif
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
#if defined(__aarch64__) || defined(_M_ARM64)
inline int tzcnt_u32_arm(uint32_t num)
{
    return __builtin_clz( __builtin_arm_rbit( num ) );
}
#endif
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
#if defined(__aarch64__) || defined(_M_ARM64)
inline int tzcnt_u64_arm(uint64_t num)
{
    return __builtin_clzll( __builtin_arm_rbit64( num ) );
}
#endif
//
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
//
#endif
